<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <!-- ins√©rer code : Consent Mode v2 (par d√©faut, EEA/UK/CH) -->
  <script>
    (function(){
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('consent', 'default', {
        ad_storage: 'denied',
        ad_user_data: 'denied',
        ad_personalization: 'denied',
        analytics_storage: 'denied',
        functionality_storage: 'granted',
        security_storage: 'granted',
        region: ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE','IS','LI','NO','GB','CH'],
        wait_for_update: 500
      });
      gtag('set','ads_data_redaction',true);
    })();
  </script>
  <!-- /ins√©rer code -->

  <!-- ins√©rer code : Google CMP (Funding Choices) -->
  <!-- ‚ö†Ô∏è COLLE ICI le snippet EXACT (2 <script>) fourni par Google (pour pub-9411950027978678) -->
  <!-- /ins√©rer code -->

  <!-- ins√©rer code : AdSense global (Auto ads) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9411950027978678" crossorigin="anonymous"></script>
  <!-- /ins√©rer code -->

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="metaTitle">Pet names ‚Äî tailored</title>
  <meta id="metaDesc" name="description" content="A tiny tool suggesting names for your pet based on species, age, and an optional photo. 100% in-browser." />
  <meta name="theme-color" content="#0f172a" />

  <!-- canonical -->
  <link rel="canonical" href="https://nix177.github.io/petnames/en/" />

  <!-- HREFLANG (toutes langues) -->
  <link rel="alternate" href="https://nix177.github.io/petnames/" hreflang="x-default" />
  <link rel="alternate" href="https://nix177.github.io/petnames/fr/" hreflang="fr" />
  <link rel="alternate" href="https://nix177.github.io/petnames/en/" hreflang="en" />
  <link rel="alternate" href="https://nix177.github.io/petnames/de/" hreflang="de" />
  <link rel="alternate" href="https://nix177.github.io/petnames/es/" hreflang="es" />
  <link rel="alternate" href="https://nix177.github.io/petnames/zh/" hreflang="zh" />
  <link rel="alternate" href="https://nix177.github.io/petnames/hi/" hreflang="hi" />
  <link rel="alternate" href="https://nix177.github.io/petnames/ar/" hreflang="ar" />
  <link rel="alternate" href="https://nix177.github.io/petnames/bn/" hreflang="bn" />

  <!-- forcer la langue de CETTE page -->
  <script>
    (function(){
      var THIS_LANG = 'en';
      try{ localStorage.setItem('petname.lang', THIS_LANG); }catch{}
      document.documentElement.lang = THIS_LANG;
      document.documentElement.dir  = 'ltr';
    })();
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0b1020; --panel:#121a2e; --muted:#aab2c8; --text:#e6ecff; --accent:#76e0c2; --accent-2:#9fb6ff; --ring:rgba(118,224,194,.5); --danger:#ff7a7a }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0a0f20,#0b1226 35%,#0a0f20);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--accent-2)}
    .wrap{max-width:980px;margin-inline:auto;padding:24px}
    header{display:flex;align-items:center;gap:16px;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:36px;height:36px;border-radius:12px;background:conic-gradient(from 140deg,#76e0c2,#9fb6ff,#76e0c2);box-shadow:0 0 0 2px rgba(255,255,255,.06) inset,0 10px 30px rgba(0,0,0,.35)}
    h1{font-size:clamp(20px,3.5vw,28px);margin:0;font-weight:700;letter-spacing:.2px}
    .tag{font-size:12px;color:#c6d2ff;background:#0f1830;border:1px solid rgba(255,255,255,.08);padding:4px 8px;border-radius:999px}
    .langpick{display:flex;align-items:center;gap:8px}
    .langpick select{background:#0f1830;border:1px solid rgba(255,255,255,.12);color:var(--text);border-radius:10px;padding:8px}
    main{margin-top:20px;display:grid;grid-template-columns:1.05fr 1fr;gap:20px}
    @media (max-width:970px){main{grid-template-columns:1fr}}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0));border:1px solid rgba(255,255,255,.08);border-radius:20px;box-shadow:0 15px 40px rgba(0,0,0,.35)}
    .pad{padding:18px}
    .controls{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .controls .col-span-2{grid-column:span 2}
    @media (max-width:620px){.controls{grid-template-columns:1fr}.controls .col-span-2{grid-column:auto}}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    select,input[type="number"],input[type="text"],.chips,.filedrop{width:100%;background:#0f1830;border:1px solid rgba(255,255,255,.08);border-radius:12px;color:var(--text);padding:12px 12px;outline:none}
    select:focus,input:focus,.filedrop:focus-within{border-color:var(--accent);box-shadow:0 0 0 4px var(--ring)}
    .row{display:flex;gap:10px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;padding:10px}
    .chip{background:#0d1530;border:1px solid rgba(255,255,255,.08);padding:8px 10px;border-radius:999px;font-size:12px;cursor:pointer;user-select:none}
    .chip.active{background:#14224a;border-color:#6fb4ff}
    .filedrop{padding:0}
    .filedrop .inner{display:flex;gap:12px;align-items:center;padding:12px}
    .filedrop input{display:none}
    .filedrop .thumb{width:52px;height:52px;border-radius:12px;background:#0d1530;display:grid;place-items:center;border:1px solid rgba(255,255,255,.08);overflow:hidden}
    .filedrop img{max-width:100%;max-height:100%;display:block}
    .hint{font-size:12px;color:#93a0c5;margin-top:6px}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{background:linear-gradient(180deg,#1d2a53,#172348);border:1px solid rgba(255,255,255,.12);padding:12px 14px;border-radius:12px;color:var(--text);font-weight:600;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,#2a3f8f,#253772);border-color:#6fb4ff}
    .btn.ghost{background:transparent;border-color:rgba(255,255,255,.14)}
    .results{padding:18px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:970px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:540px){.grid{grid-template-columns:1fr}}
    .card{background:#0f1830;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px;display:flex;gap:12px;align-items:center;justify-content:space-between}
    .name{font-size:18px;font-weight:700;letter-spacing:.2px}
    .sub{font-size:12px;color:#9bb0e0}
    .card .tools{display:flex;gap:8px}
    .iconbtn{border:1px solid rgba(255,255,255,.14);background:#0d1530;border-radius:10px;padding:8px;cursor:pointer}
    .favorites{display:flex;gap:8px;flex-wrap:wrap}
    .fav{background:#0d1530;border:1px solid rgba(255,255,255,.08);padding:8px 10px;border-radius:999px;font-size:12px}
    footer{margin-top:26px;font-size:12px;color:#8ea0d2;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .small{font-size:12px;color:#90a0c7}
    .ad{background:repeating-linear-gradient(45deg,rgba(255,255,255,.06),rgba(255,255,255,.06) 10px,rgba(255,255,255,.03) 10px,rgba(255,255,255,.03) 20px);border:1px dashed rgba(255,255,255,.2);border-radius:14px;color:#bfc8df;display:grid;place-items:center;height:90px;font-size:12px}
    .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#111b32;border:1px solid rgba(255,255,255,.14);color:#fff;padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:opacity .25s ease}
    .toast.show{opacity:1}
    /* Banner d‚Äôinfo IA */
    .banner{display:none;margin:10px 0;padding:10px;border-radius:10px;background:#0e1835;border:1px solid rgba(255,255,255,.15);font-size:12px}
    .banner.show{display:block}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1 id="appTitle">Pet names ‚Äî tailored</h1>
          <div class="tag" id="appTag">Generates ideas based on species, age, and photo (optional)</div>
        </div>
      </div>

      <div class="langpick">
        <label for="lang" class="small" id="labelLang">Language</label>
        <select id="lang" aria-label="Choose language">
          <option value="fr">FR</option>
          <option value="en" selected>EN</option>
          <option value="de">DE</option>
          <option value="es">ES</option>
          <option value="zh">‰∏≠Êñá</option>
          <option value="hi">HI</option>
          <option value="ar">AR</option>
          <option value="bn">BN</option>
        </select>
      </div>

      <div style="min-width:180px;flex:0 0 180px">
        <div style="margin-top:18px">
          <!-- ins√©rer code : bloc pub en-t√™te (remplace data-ad-slot) -->
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-9411950027978678"
               data-ad-slot="REPLACE_WITH_SLOT_HEADER"
               data-ad-format="horizontal"
               data-full-width-responsive="true"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
          <!-- /ins√©rer code -->
        </div>
      </div>
    </header>

    <main class="panel">
      <section class="pad" aria-label="Form">
        <div class="controls">
          <div>
            <label id="labelSpecies" for="species">Species</label>
            <select id="species" aria-label="Species">
              <option value="chien">üê∂ Dog</option>
              <option value="chat">üê± Cat</option>
              <option value="oiseau">üê¶ Bird</option>
              <option value="lapin">üê∞ Rabbit</option>
              <option value="cheval">üê¥ Horse</option>
              <option value="reptile">ü¶é Reptile</option>
              <option value="rongeur">üê≠ Rodent</option>
              <option value="poisson">üêü Fish</option>
              <option value="autre">‚ú® Other</option>
            </select>
          </div>
          <div>
            <label id="labelAge" for="age">Age</label>
            <div class="row">
              <input id="age" type="number" min="0" step="0.1" placeholder="e.g. 2" aria-label="Age"/>
              <select id="ageUnit" aria-label="Age unit">
                <option value="years">years</option>
                <option value="months">months</option>
              </select>
            </div>
          </div>
          <div>
            <label id="labelSex" for="sex">Sex (optional)</label>
            <select id="sex">
              <option value="inconnu">Unknown</option>
              <option value="femelle">Female</option>
              <option value="m√¢le">Male</option>
            </select>
          </div>
          <div>
            <label id="labelStyles">Name style (optional)</label>
            <div id="styles" class="chips" role="group" aria-label="Styles">
              <div class="chip" data-style="mignon" id="chip-style-mignon">Cute</div>
              <div class="chip" data-style="classique" id="chip-style-classique">Classic</div>
              <div class="chip" data-style="nature" id="chip-style-nature">Nature</div>
              <div class="chip" data-style="mythologique" id="chip-style-mythologique">Mythologic</div>
              <div class="chip" data-style="fantaisie" id="chip-style-fantaisie">Fantasy</div>
              <div class="chip" data-style="court" id="chip-style-court">Short (‚â§2 syl.)</div>
            </div>
          </div>
          <div class="col-span-2">
            <label id="labelTraits">Personality (optional)</label>
            <div id="traits" class="chips" role="group" aria-label="Traits">
              <div class="chip" data-trait="joueur" id="chip-trait-joueur">Playful</div>
              <div class="chip" data-trait="calme" id="chip-trait-calme">Calm</div>
              <div class="chip" data-trait="curieux" id="chip-trait-curieux">Curious</div>
              <div class="chip" data-trait="brave" id="chip-trait-brave">Brave</div>
              <div class="chip" data-trait="malin" id="chip-trait-malin">Clever</div>
              <div class="chip" data-trait="doux" id="chip-trait-doux">Gentle</div>
              <div class="chip" data-trait="royal" id="chip-trait-royal">Regal</div>
              <div class="chip" data-trait="sage" id="chip-trait-sage">Wise</div>
            </div>
          </div>

          <div class="col-span-2">
            <label id="labelPhoto">Pet photo (optional)</label>
            <div class="filedrop" id="filedrop">
              <div class="inner">
                <div class="thumb" id="thumb" aria-hidden="true">üì∑</div>
                <div>
                  <strong id="photoDrop">Drop an image here</strong> <span id="photoOr">or</span> <label for="file" id="photoClick" style="text-decoration:underline;cursor:pointer">click to choose</label>
                  <input id="file" type="file" accept="image/*" />
                  <div class="hint" id="photoHint">The image is not uploaded ‚Äî it stays on your device. Dominant colors help refine ideas.</div>
                  <div id="aiBanner" class="banner">This image may be sent to our AI backend to improve name ideas. <button id="aiAllow" class="btn" style="padding:6px 10px;margin-left:8px">Allow once</button> <button id="aiAlways" class="btn ghost" style="padding:6px 10px;margin-left:6px">Always allow</button> <button id="aiDeny" class="btn ghost" style="padding:6px 10px;margin-left:6px">Don‚Äôt send</button></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="generate">Generate names</button>
          <button class="btn ghost" id="randomize">Randomize</button>
          <button class="btn ghost" id="clear">Reset</button>
        </div>
      </section>

      <section class="results" aria-live="polite">
        <div style="margin-bottom:10px" class="small"><span id="suggestionsTitle">Suggestions</span> (<span id="count">0</span>)</div>
        <div class="grid" id="grid"></div>
        <div style="margin-top:14px" class="small" id="favoritesTitle">Favorites</div>
        <div class="favorites" id="favorites"></div>
        <div style="margin-top:18px">
          <!-- ins√©rer code : bloc pub sous r√©sultats (remplace data-ad-slot) -->
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-9411950027978678"
               data-ad-slot="REPLACE_WITH_SLOT_BOTTOM"
               data-ad-format="horizontal"
               data-full-width-responsive="true"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
          <!-- /ins√©rer code -->
        </div>
      </section>
    </main>

    <footer>
      <div id="footerLeft">¬© <span id="year"></span> ‚Äî Tiny static app. Images stay local. <a href="#" id="exportFavs">Export favorites</a></div>
      <div><a href="#" id="share">Share this setup</a></div>
    </footer>
  </div>

  <div class="toast" id="toast">Copied ‚úî</div>

  <script>
    // ‚Äî‚Äî‚Äî Configuration ‚Äî‚Äî‚Äî
    // ins√©rer code ‚Äî config API (remplace par l‚ÄôURL Vercel de ton endpoint)
    const CONFIG = {
      apiEndpoint: 'https://YOUR-VERCEL-APP.vercel.app/api/generate'
    };
    // /ins√©rer code

    const $  = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const I18N = {
      en:{dir:'ltr',metaTitle:'Pet names ‚Äî tailored',metaDesc:'A tiny tool suggesting names for your pet based on species, age, and an optional photo. 100% in-browser.',appTitle:'Pet names ‚Äî tailored',appTag:'Generates ideas based on species, age, and photo (optional)',labelLang:'Language',labelSpecies:'Species',species:{chien:'üê∂ Dog',chat:'üê± Cat',oiseau:'üê¶ Bird',lapin:'üê∞ Rabbit',cheval:'üê¥ Horse',reptile:'ü¶é Reptile',rongeur:'üê≠ Rodent',poisson:'üêü Fish',autre:'‚ú® Other'},labelAge:'Age',agePlaceholder:'e.g. 2',unitYears:'years',unitMonths:'months',labelSex:'Sex (optional)',sex:{inconnu:'Unknown',femelle:'Female','m√¢le':'Male'},labelStyles:'Name style (optional)',styles:{mignon:'Cute',classique:'Classic',nature:'Nature',mythologique:'Mythologic',fantaisie:'Fantasy',court:'Short (‚â§2 syl.)'},labelTraits:'Personality (optional)',traits:{joueur:'Playful',calme:'Calm',curieux:'Curious',brave:'Brave',malin:'Clever',doux:'Gentle',royal:'Regal',sage:'Wise'},labelPhoto:'Pet photo (optional)',photoDrop:'Drop an image here',photoOr:'or',photoClick:'click to choose',photoHint:'The image is not uploaded ‚Äî it stays on your device. Dominant colors help refine ideas.',btnGenerate:'Generate names',btnRandomize:'Randomize',btnClear:'Reset',suggestionsTitle:'Suggestions',favoritesTitle:'Favorites',footerLeftPrefix:'¬©',footerLeftText:'‚Äî Tiny static app. Images stay local.',exportFavs:'Export favorites',share:'Share this setup',toastCopied:'Copied ‚úî',toolCopy:'Copy',toolFav:'Favorite',toolCard:'Card',cardSubtitle:'Suggested name for your companion',cardFooter:'petnames.one ‚Äî offline, no image upload',ageMonths:n=>`${n} months`,ageYears:y=>`${y} years`}
    };

    const state = {
      image: null,
      imageColors: [],
      favorites: JSON.parse(localStorage.getItem('petname.favs')||'[]'),
      lastResults: [],
      lastForm: null,
      labels: I18N.en,
      aiPhotoPolicy: localStorage.getItem('ai_photo_policy') || 'ask' // 'ask' | 'allow' | 'deny'
    };

    const toast = (msg)=>{ const t=$('#toast'); t.textContent = msg || state.labels.toastCopied; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1200); };
    const setCount = n => $('#count').textContent = String(n);

    // ‚Äî‚Äî‚Äî Chips ‚Äî‚Äî‚Äî
    function setupChips(containerSel){
      const cont = $(containerSel);
      cont.addEventListener('click', (e)=>{
        const chip = e.target.closest('.chip');
        if(!chip) return;
        chip.classList.toggle('active');
      });
    }
    setupChips('#styles'); setupChips('#traits');

    // ‚Äî‚Äî‚Äî Drag & Drop image ‚Äî‚Äî‚Äî
    const fileInput = $('#file');
    const filedrop  = $('#filedrop');
    const thumb     = $('#thumb');
    const aiBanner  = $('#aiBanner');

    function preview(file){
      if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        state.image = reader.result;
        const img = new Image();
        img.onload = () => {
          thumb.innerHTML = '';
          thumb.appendChild(img);
          extractDominantColors(img).then(colors=>{
            state.imageColors = colors;
          });
          updateAIBanner(); // afficher/masquer le bandeau IA
        };
        img.src = reader.result;
      };
      reader.readAsDataURL(file);
    }

    function updateAIBanner(){
      if(!state.image) { aiBanner.classList.remove('show'); return; }
      aiBanner.classList.toggle('show', state.aiPhotoPolicy === 'ask');
    }

    $('#aiAllow').addEventListener('click', ()=>{ state.aiPhotoPolicy = 'allow'; aiBanner.classList.remove('show'); });
    $('#aiAlways').addEventListener('click', ()=>{ state.aiPhotoPolicy = 'allow'; localStorage.setItem('ai_photo_policy','allow'); aiBanner.classList.remove('show'); });
    $('#aiDeny').addEventListener('click', ()=>{ state.aiPhotoPolicy = 'deny'; localStorage.setItem('ai_photo_policy','deny'); aiBanner.classList.remove('show'); });

    fileInput.addEventListener('change', e=> preview(e.target.files?.[0]));
    ;['dragenter','dragover'].forEach(ev=>{
      filedrop.addEventListener(ev, e=>{e.preventDefault(); filedrop.style.borderColor = '#6fb4ff';});
    });
    ;['dragleave','drop'].forEach(ev=>{
      filedrop.addEventListener(ev, e=>{e.preventDefault(); filedrop.style.borderColor = 'rgba(255,255,255,.08)';});
    });
    filedrop.addEventListener('drop', e=>{
      const f = e.dataTransfer.files?.[0];
      if(f && f.type.startsWith('image/')) preview(f);
    });

    // ‚Äî‚Äî‚Äî Form helpers ‚Äî‚Äî‚Äî
    function getForm(){
      const species = $('#species').value;
      const ageVal = parseFloat($('#age').value || '0');
      const ageMonths = $('#ageUnit').value === 'years' ? Math.round(ageVal*12) : Math.round(ageVal);
      const sex = $('#sex').value;
      const styles = $$('#styles .chip.active').map(c=>c.dataset.style);
      const traits = $$('#traits .chip.active').map(c=>c.dataset.trait);
      return {
        species, ageMonths, sex, styles, traits,
        colorHints: state.imageColors,
        hasImage: !!state.image,
        imageDataUrl: state.image || null
      };
    }

    function randomize(){
      const speciesOpts = ['chien','chat','oiseau','lapin','cheval','reptile','rongeur','poisson','autre'];
      $('#species').value = pick(speciesOpts);
      $('#age').value = (Math.random()*8).toFixed(1);
      $('#ageUnit').value = Math.random()>.5 ? 'years' : 'months';
      $('#sex').value = pick(['inconnu','femelle','m√¢le']);
      ['#styles','#traits'].forEach(sel=>{
        $$(sel+' .chip').forEach(c=>c.classList.remove('active'));
        $$(sel+' .chip').filter(()=>Math.random()>.65).forEach(c=>c.classList.add('active'));
      });
    }

    $('#randomize').addEventListener('click', randomize);
    $('#clear').addEventListener('click', ()=>{ location.href = location.pathname; });

    // ‚Äî‚Äî‚Äî Generation ‚Äî‚Äî‚Äî
    $('#generate').addEventListener('click', async ()=>{
      const form = getForm();

      // Politique confidentialit√© ‚ÄúIA‚Äù c√¥t√© utilisateur :
      if(CONFIG.apiEndpoint){
        if(form.hasImage){
          if(state.aiPhotoPolicy === 'deny'){ form.imageDataUrl = null; form.hasImage = false; }
          else if(state.aiPhotoPolicy === 'ask'){
            // si banni√®re encore visible, on ne bloque pas, mais on envoie par d√©faut SANS image
            form.imageDataUrl = null; form.hasImage = false;
          }
        }
      }

      const names = CONFIG.apiEndpoint ? await generateRemote(form) : generateLocal(form);
      state.lastResults = names; state.lastForm = form;
      renderResults(names, form);
    });

    async function generateRemote(form){
      try{
        const res = await fetch(CONFIG.apiEndpoint, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(form),
          // Important si Vercel limite l‚Äôorigin : on envoie Referer automatiquement
        });
        if(!res.ok) throw new Error('Bad status '+res.status);
        const data = await res.json();
        if(Array.isArray(data.names)) return data.names.slice(0,24);
      }catch(err){
        console.warn('Remote generation failed, using local.', err);
      }
      return generateLocal(form);
    }

    // ‚Äî‚Äî‚Äî Local name generator (fallback) ‚Äî‚Äî‚Äî
    function generateLocal({species, ageMonths, sex, styles, traits, colorHints}){
      const pool = buildSyllablePool(species, styles);
      const targetSyll = styles.includes('court') ? [1,2] : [1,2,2,3];
      const ageTag = ageMonths <= 12 ? 'b√©b√©' : ageMonths < 72 ? 'jeune' : 'adulte';
      const vibe = [...styles, ...traits, ageTag, sex];
      const colorNames = colorHintsToNames(colorHints);

      const results = new Set();
      let fails = 0;
      while(results.size < 18 && fails < 200){
        const sylCount = pick(targetSyll);
        let name = '';
        for(let i=0;i<sylCount;i++) name += pick(pool);
        name = postProcess(name, species, vibe);
        if(colorNames.length && Math.random()>0.7){ name = blend(name, pick(colorNames)); }
        name = name.charAt(0).toUpperCase() + name.slice(1);
        if(/^[A-Za-z√Ä-√ø\-]{3,15}$/.test(name)) results.add(name);
        else fails++;
      }
      const themed = themedNames(species, styles, colorHints, sex);
      themed.forEach(n=>results.add(n));
      return Array.from(results).slice(0,24);
    }

    function buildSyllablePool(species, styles){
      const base = ['lo','la','li','lu','ly','no','na','ne','ni','nu','mi','ma','mo','mu','ka','ko','ki','ku','zo','za','ze','zi','zu','ru','ra','re','ri','ro','ta','te','ti','to','tu','po','pa','pe','pi','pu','fa','fe','fi','fo','ga','go','gi','gu','ya','yo','yu','bo','ba','be','bi','bu','cha','cho','chi','chu','sha','sho','shi','shu','co','ca','ce','ci','cu','do','da','de','di','du','el','en','ar','is','or','us','an','in','on','eu','√©','lae','rae','lyr','my','ny','ae','ia','eo'];
      const cat = ['mi','min','ny','nya','roux','rou','cha','cha','tou','tou','plu','plume','shi','mou','pel','pel','gra','gris','nois','sette'];
      const dog = ['rex','max','kai','kao','bao','brun','dog','wolf','ran','bark','nix','fox','zo','zor','zor','bal','kan','leo'];
      const bird = ['pi','pio','twi','twi','rio','rio','ari','ari','lark','azur','ciel','plu','plu','aer','avel'];
      const rabbit = ['lap','pin','nois','ette','coco','neige','flop','eared','pom','pon','nini'];
      const horse = ['gal','lop','ael','ael','mane','crin','siro','safir','lune','sole','vento'];
      const reptile = ['sli','ther','sco','co','yra','yr','ona','gex','gla','dru'];
      const rodent = ['nois','ette','miot','mimi','pix','pip','tika','nux'];
      const fish = ['na','ri','mo','ma','mar','bril','azur','coral','nemo','bub'];
      const other = ['zeph','lyr','neo','or','el','aer','myr','quill'];

      let speciesPool = base;
      switch(species){
        case 'chat': speciesPool = base.concat(cat); break;
        case 'chien': speciesPool = base.concat(dog); break;
        case 'oiseau': speciesPool = base.concat(bird); break;
        case 'lapin': speciesPool = base.concat(rabbit); break;
        case 'cheval': speciesPool = base.concat(horse); break;
        case 'reptile': speciesPool = base.concat(reptile); break;
        case 'rongeur': speciesPool = base.concat(rodent); break;
        case 'poisson': speciesPool = base.concat(fish); break;
        default: speciesPool = base.concat(other); break;
      }

      if(styles.includes('mythologique')) speciesPool = speciesPool.concat(['aen','aeon','thor','odin','isis','hera','zeus','posei','dion','ra','yor']);
      if(styles.includes('nature')) speciesPool = speciesPool.concat(['flor','luz','sol','lune','neige','mousse','√©cor','ciel','roc','bois','vent']);
      if(styles.includes('fantaisie')) speciesPool = speciesPool.concat(['fae','fae','lyn','wyn','ari','syl','drac','pyro','hydra','glen','vale']);
      if(styles.includes('classique')) speciesPool = speciesPool.concat(['bella','louis','l√©o','lena','milo','nina','nora','nora','paul','tom','jade','lila']);

      return speciesPool;
    }

    function postProcess(name, species, vibe){
      name = name.replace(/([a-z√©√†√®])\1{2,}/gi,'$1$1');
      name = name.replace(/([aeiouy])([aeiouy])/gi,'$1');
      if(species==='chat'||species==='chien'){ name = name.replace(/ny|nya/gi,'nya'); }
      if(vibe.includes('mignon')){
        if(!/[ou]$/.test(name)) name += pick(['ou','u','ou','i']);
      }
      if(vibe.includes('court')){
        name = name.replace(/([a-z]{1,3}).*/i,'$1');
        if(name.length<3) name += pick(['a','i','o']);
      }
      return name;
    }

    function blend(a,b){
      const clean = String(b||'').replace(/[^A-Za-z√Ä-√ø]/g,'');
      if(!clean) return a;
      return Math.random()<0.5 ? (clean + a.toLowerCase()) : (a + clean);
    }

    function colorHintsToNames(hints){
      const map = {
        ambre: ['Ambre','Miel','Caramel','Cannelle','Moka'],
        neige: ['Neige','Perle','Lumi','Ivory','Aurore'],
        √©b√®ne: ['√âb√®ne','Sombrelune','Onyx','R√©glisse'],
        cuivre: ['Cuivre','Roux','Ch√¢taigne','Noisette','Flamme'],
        saphir: ['Saphir','Azura','Bleuet','Ciel'],
        jade: ['Jade','Verdi','Mousse','√âmeraude'],
        corail: ['Corail','Ros√©e','P√™che','Saumon']
      };
      const out = [];
      hints.forEach(h=>{ (map[h]||[]).forEach(n=>out.push(n)); });
      return out;
    }

    function themedNames(species, styles, colorHints, sex){
      const bank = [];
      if(styles.includes('classique')) bank.push(...(sex==='femelle' ? ['Luna','Bella','Lily','Nina','Jade'] : ['Milo','L√©o','Oscar','Toby','Hugo']));
      if(styles.includes('mythologique')) bank.push(...['Herm√®s','Ga√Øa','Iris','Nox','Thor','H√©ra','Ath√©na','Orion']);
      if(styles.includes('nature')) bank.push(...['Bambou','Brise','Flocon','Ros√©e','Ruisseau','Brume']);
      if(colorHints.includes('ambre')) bank.push('Canelle','Moka');
      if(species==='oiseau') bank.push('Plume','Azur');
      if(species==='cheval') bank.push('Temp√™te','Galop');
      if(species==='poisson') bank.push('Bubble','Coral');
      return shuffle(bank).slice(0,6);
    }

    // ‚Äî‚Äî‚Äî Image color extraction ‚Äî‚Äî‚Äî
    async function extractDominantColors(img){
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d', { willReadFrequently: true });
      const w = canvas.width = 120;
      const h = canvas.height = Math.round(img.height * (w/img.width));
      ctx.drawImage(img, 0, 0, w, h);
      const data = ctx.getImageData(0,0,w,h).data;
      let r=0,g=0,b=0,count=0,sumL=0;
      for(let i=0;i<data.length;i+=16){
        const R=data[i], G=data[i+1], B=data[i+2], a=data[i+3];
        if(a<180) continue;
        r+=R; g+=G; b+=B; count++;
        sumL += 0.2126*R + 0.7152*G + 0.0722*B;
      }
      if(!count) return [];
      r=Math.round(r/count); g=Math.round(g/count); b=Math.round(b/count);
      const avgL = sumL/count;
      const hue = rgbToHue(r,g,b);
      const colors=[];
      if(avgL>210) colors.push('neige');
      if(avgL<60) colors.push('√©b√®ne');
      if(hue>=15 && hue<45) colors.push('ambre');
      if(hue>=45 && hue<90) colors.push('jade');
      if(hue>=190 && hue<250) colors.push('saphir');
      if(hue>=330 || hue<15) colors.push('corail');
      if(hue>=15 && hue<25) colors.push('cuivre');
      return Array.from(new Set(colors));
    }
    function rgbToHue(r,g,b){
      r/=255; g/=255; b/=255;
      const max=Math.max(r,g,b), min=Math.min(r,g,b);
      const d=max-min; if(d===0) return 0;
      let h;
      switch(max){ case r: h=(g-b)/d + (g<b?6:0); break;
        case g: h=(b-r)/d + 2; break;
        case b: h=(r-g)/d + 4; break; }
      h/=6; return Math.round(h*360);
    }

    // ‚Äî‚Äî‚Äî Render ‚Äî‚Äî‚Äî
    function renderResults(names, form){
      const grid = $('#grid');
      grid.innerHTML = '';
      names.forEach(n=> grid.appendChild(nameCard(n, form)));
      setCount(names.length);
      renderFavs();
      const params=new URLSearchParams(location.search);
      params.set('species',form.species);
      params.set('age',form.ageMonths);
      params.set('sex',form.sex);
      if(form.styles.length) params.set('styles', form.styles.join(','));
      if(form.traits.length) params.set('traits', form.traits.join(','));
      history.replaceState({},'',`${location.pathname}?${params.toString()}`);
    }

    function nameCard(name, form){
      const card=document.createElement('div');
      card.className='card';
      const left=document.createElement('div');
      left.innerHTML = `<div class="name">${escapeHtml(name)}</div><div class="sub">${emojiFor(form.species)} ${escapeHtml(displaySpecies(form.species))} ‚Ä¢ ${humanAge(form.ageMonths)} ‚Ä¢ ${escapeHtml(displaySex(form.sex))}</div>`;
      const tools=document.createElement('div');
      tools.className='tools';
      const btnCopy=iconButton('üìã',state.labels.toolCopy||'Copy');
      btnCopy.addEventListener('click',()=>{ navigator.clipboard.writeText(name); toast(); });
      const btnFav=iconButton(isFav(name)?'‚òÖ':'‚òÜ',state.labels.toolFav||'Favorite');
      btnFav.addEventListener('click',()=>{ toggleFav(name); btnFav.textContent=isFav(name)?'‚òÖ':'‚òÜ'; renderFavs(); });
      const btnCard=iconButton('üñºÔ∏è',state.labels.toolCard||'Card');
      btnCard.addEventListener('click',()=>{ downloadCard(name); });
      tools.append(btnCopy,btnFav,btnCard);
      card.append(left, tools);
      return card;
    }

    function iconButton(txt,title){ const b=document.createElement('button'); b.className='iconbtn'; b.textContent=txt; b.title=title; return b; }
    function emojiFor(species){ return { chien:'üê∂', chat:'üê±', oiseau:'üê¶', lapin:'üê∞', cheval:'üê¥', reptile:'ü¶é', rongeur:'üê≠', poisson:'üêü', autre:'‚ú®' }[species] || 'üêæ'; }
    function displaySpecies(val){ const map = I18N.en.species || {}; return map[val] ? map[val].replace(/^\p{Emoji_Presentation}\s*/u,'') : val; }
    function displaySex(val){ return (I18N.en.sex||{})[val] || val; }
    function humanAge(months){ if(months<12) return I18N.en.ageMonths(months); const y=(Math.round((months/12)*10)/10); return I18N.en.ageYears(y); }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g,(c)=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}[c])); }

    // ‚Äî‚Äî‚Äî Favs ‚Äî‚Äî‚Äî
    function isFav(n){ return state.favorites.includes(n); }
    function toggleFav(n){ const i=state.favorites.indexOf(n); if(i>=0) state.favorites.splice(i,1); else state.favorites.push(n); persistFavs(); }
    function persistFavs(){ localStorage.setItem('petname.favs', JSON.stringify(state.favorites)); }
    function renderFavs(){ const cont=$('#favorites'); cont.innerHTML=''; state.favorites.forEach(n=>{ const s=document.createElement('span'); s.className='fav'; s.textContent=n; cont.appendChild(s); }); }
    document.addEventListener('click',(e)=>{ const a=e.target.closest('#exportFavs'); if(a){ e.preventDefault(); const blob=new Blob([state.favorites.join('\n')],{type:'text/plain'}); const url=URL.createObjectURL(blob); const a2=document.createElement('a'); a2.href=url; a2.download='favorites.txt'; a2.click(); URL.revokeObjectURL(url); }});
    $('#share')?.addEventListener('click',(e)=>{ e.preventDefault(); navigator.clipboard.writeText(location.href).then(()=>toast('Copied ‚úî')); });

    // ‚Äî‚Äî‚Äî Image card ‚Äî‚Äî‚Äî
    function downloadCard(name){
      const canvas=document.createElement('canvas');
      const w=900,h=500; canvas.width=w; canvas.height=h;
      const ctx=canvas.getContext('2d');
      const grad=ctx.createLinearGradient(0,0,w,h); grad.addColorStop(0,'#0d1530'); grad.addColorStop(1,'#0b1126'); ctx.fillStyle=grad; ctx.fillRect(0,0,w,h);
      if(state.image){ const img=new Image(); img.onload=()=>{ drawCard(ctx,w,h,img,name); save(); }; img.src=state.image; }
      else { drawCard(ctx,w,h,null,name); save(); }
      function save(){ const a=document.createElement('a'); a.download=`${name}.png`; a.href=canvas.toDataURL('image/png'); a.click(); }
    }
    function drawCard(ctx,w,h,img,name){
      if(img){ const r=180; const x=w-220, y=140; roundImage(ctx,img,x,y,r); }
      ctx.fillStyle='#fff'; ctx.font='700 72px Inter, sans-serif'; ctx.fillText(name,60,200);
      ctx.font='400 22px Inter, sans-serif'; ctx.fillStyle='rgba(255,255,255,.8)'; ctx.fillText(I18N.en.cardSubtitle,60,240);
      ctx.font='400 16px Inter, sans-serif'; ctx.fillStyle='rgba(255,255,255,.55)'; ctx.fillText(I18N.en.cardFooter,60,280);
    }
    function roundImage(ctx,img,x,y,r){
      ctx.save(); ctx.beginPath(); ctx.arc(x+r,y+r,r,0,Math.PI*2); ctx.closePath(); ctx.clip();
      const size=Math.min(img.width,img.height);
      ctx.drawImage(img,(img.width-size)/2,(img.height-size)/2,size,size,x,y,r*2,r*2);
      ctx.restore();
    }

    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
    function shuffle(arr){ return arr.map(a=>[Math.random(),a]).sort((a,b)=>a[0]-b[0]).map(a=>a[1]); }

    // ‚Äî‚Äî‚Äî Init ‚Äî‚Äî‚Äî
    document.addEventListener('DOMContentLoaded', ()=>{
      $('#year').textContent = new Date().getFullYear();
      renderFavs();

      // Hydrate depuis l‚ÄôURL
      const q=new URLSearchParams(location.search);
      if(q.get('species')) $('#species').value=q.get('species');
      if(q.get('age')){ const m=Number(q.get('age')); if(m>=12){ $('#age').value=(m/12).toFixed(1); $('#ageUnit').value='years'; } else { $('#age').value=m; $('#ageUnit').value='months'; } }
      if(q.get('sex')) $('#sex').value=q.get('sex');
      if(q.get('styles')) q.get('styles').split(',').forEach(s=>{ const c=$(`#styles .chip[data-style="${CSS.escape(s)}"]`); c && c.classList.add('active'); });
      if(q.get('traits')) q.get('traits').split(',').forEach(t=>{ const c=$(`#traits .chip[data-trait="${CSS.escape(t)}"]`); c && c.classList.add('active'); });

      // s√©lecteur de langue -> navigation par dossier
      document.querySelector('#lang').addEventListener('change', (e)=>{
        const SUPPORTED = ["fr","en","de","es","zh","hi","ar","bn"];
        let next = String(e.target.value).toLowerCase();
        if(!SUPPORTED.includes(next)) next = 'en';
        const keepKeys = ["species","age","sex","styles","traits"];
        const kept = new URLSearchParams();
        keepKeys.forEach(k=>{ if(q.has(k)) kept.set(k,q.get(k)); });
        const qs = kept.toString();
        // calcule la racine du projet (ex: /petnames/)
        const parts = location.pathname.split("/").filter(Boolean);
        if(parts.length >= 2) parts.pop(); // retire 'en'
        const root = "/" + parts.join("/") + "/";
        location.href = root + next + "/" + (qs? ("?"+qs) : "");
      });
    });
  </script>
</body>
</html>
