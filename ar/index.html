<!DOCTYPE html>
<html lang="ar">
<head>
  <!-- Consent Mode v2 (EEA/UK/CH par dÃ©faut) -->
  <script>
    (function(){
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('consent', 'default', {
        ad_storage: 'denied',
        ad_user_data: 'denied',
        ad_personalization: 'denied',
        analytics_storage: 'denied',
        functionality_storage: 'granted',
        security_storage: 'granted',
        region: ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE','IS','LI','NO','GB','CH'],
        wait_for_update: 500
      });
      gtag('set','ads_data_redaction',true);
    })();
  </script>
  <!-- /Consent -->

  <!-- Google CMP (Funding Choices) â€” colle ici les 2 <script> fournis par Google si tu lâ€™actives -->
  <!--
  <script async src="https://fundingchoicesmessages.google.com/i/pub-9411950027978678?ers=1" nonce="..."></script>
  <script>(function(){function signalGooglefcPresent(){if(!window.frames['googlefcPresent']){if(document.body){const f=document.createElement('iframe');f.style.cssText='width:0;height:0;border:0;display:none';f.name='googlefcPresent';document.body.appendChild(f);}else{setTimeout(signalGooglefcPresent,50);}}} signalGooglefcPresent();})();</script>
  -->

  <!-- AdSense global (Auto ads) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9411950027978678" crossorigin="anonymous"></script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="metaTitle">Ø£Ø³Ù…Ø§Ø¡ Ù„Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ø£Ù„ÙŠÙØ© â€” Ù…Ø®ØµÙ‘ØµØ©</title>
  <meta id="metaDesc" name="description" content="Ø£Ø¯Ø§Ø© ØµØºÙŠØ±Ø© ØªÙ‚ØªØ±Ø­ Ø£Ø³Ù…Ø§Ø¡Ù‹ Ù„Ø­ÙŠÙˆØ§Ù†Ùƒ Ø§Ù„Ø£Ù„ÙŠÙ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ ÙˆØ§Ù„Ø¹Ù…Ø± ÙˆØµÙˆØ±Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©. ØªØ¹Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­." />
  <meta name="theme-color" content="#0f172a" />

  <!-- Canonical -->
  <link rel="canonical" href="https://nix177.github.io/petnames/ar/" />
  <!-- Hreflang -->
  <link rel="alternate" href="https://nix177.github.io/petnames/" hreflang="x-default" />
  <link rel="alternate" href="https://nix177.github.io/petnames/fr/" hreflang="fr" />
  <link rel="alternate" href="https://nix177.github.io/petnames/en/" hreflang="en" />
  <link rel="alternate" href="https://nix177.github.io/petnames/de/" hreflang="de" />
  <link rel="alternate" href="https://nix177.github.io/petnames/es/" hreflang="es" />
  <link rel="alternate" href="https://nix177.github.io/petnames/zh/" hreflang="zh" />
  <link rel="alternate" href="https://nix177.github.io/petnames/hi/" hreflang="hi" />
  <link rel="alternate" href="https://nix177.github.io/petnames/ar/" hreflang="ar" />
  <link rel="alternate" href="https://nix177.github.io/petnames/bn/" hreflang="bn" />

  <!-- Forcer langue/dir -->
  <script>
    (function(){
      var THIS_LANG = 'ar';
      try{ localStorage.setItem('petname.lang', THIS_LANG); }catch{}
      document.documentElement.lang = THIS_LANG;
      document.documentElement.dir  = 'rtl';
    })();
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#0b1020; --panel:#121a2e; --muted:#aab2c8; --text:#e6ecff; --accent:#76e0c2; --accent-2:#9fb6ff; --ring:rgba(118,224,194,.5); --danger:#ff7a7a }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0a0f20, #0b1226 35%, #0a0f20);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--accent-2)}
    .wrap{max-width:980px;margin-inline:auto;padding:24px}
    header{display:flex;align-items:center;gap:16px;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:36px;height:36px;border-radius:12px;background:conic-gradient(from 140deg, #76e0c2, #9fb6ff, #76e0c2); box-shadow:0 0 0 2px rgba(255,255,255,.06) inset, 0 10px 30px rgba(0,0,0,.35)}
    h1{font-size:clamp(20px,3.5vw,28px);margin:0;font-weight:700;letter-spacing:.2px}
    .tag{font-size:12px;color:#c6d2ff;background:#0f1830;border:1px solid rgba(255,255,255,.08);padding:4px 8px;border-radius:999px}
    .langpick{display:flex;align-items:center;gap:8px}
    .langpick select{background:#0f1830;border:1px solid rgba(255,255,255,.12);color:var(--text);border-radius:10px;padding:8px}
    main{margin-top:20px;display:grid;grid-template-columns:1.05fr 1fr;gap:20px}
    @media (max-width:970px){main{grid-template-columns:1fr}}
    .panel{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.0)); border:1px solid rgba(255,255,255,.08); border-radius:20px; box-shadow:0 15px 40px rgba(0,0,0,.35)}
    .pad{padding:18px}
    .controls{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .controls .col-span-2{grid-column:span 2}
    @media (max-width:620px){.controls{grid-template-columns:1fr}.controls .col-span-2{grid-column:auto}}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    select,input[type="number"],input[type="text"],.chips,.filedrop{width:100%;background:#0f1830;border:1px solid rgba(255,255,255,.08);border-radius:12px;color:var(--text);padding:12px 12px;outline:none}
    select:focus,input:focus,.filedrop:focus-within{border-color:var(--accent); box-shadow:0 0 0 4px var(--ring)}
    .row{display:flex;gap:10px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;padding:10px}
    .chip{background:#0d1530;border:1px solid rgba(255,255,255,.08);padding:8px 10px;border-radius:999px;font-size:12px;cursor:pointer;user-select:none}
    .chip.active{background:#14224a;border-color:#6fb4ff}
    .filedrop{padding:0}
    .filedrop .inner{display:flex;gap:12px;align-items:center;padding:12px}
    .filedrop input{display:none}
    .filedrop .thumb{width:52px;height:52px;border-radius:12px;background:#0d1530;display:grid;place-items:center;border:1px solid rgba(255,255,255,.08);overflow:hidden}
    .filedrop img{max-width:100%;max-height:100%;display:block}
    .hint{font-size:12px;color:#93a0c5;margin-top:6px}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .btn{background:linear-gradient(180deg,#1d2a53,#172348); border:1px solid rgba(255,255,255,.12);padding:12px 14px;border-radius:12px;color:var(--text);font-weight:600;cursor:pointer}
    .btn.primary{background:linear-gradient(180deg,#2a3f8f,#253772);border-color:#6fb4ff}
    .btn.ghost{background:transparent;border-color:rgba(255,255,255,.14)}
    .results{padding:18px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:970px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:540px){.grid{grid-template-columns:1fr}}
    .card{background:#0f1830;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px;display:flex;gap:12px;align-items:center;justify-content:space-between}
    .name{font-size:18px;font-weight:700;letter-spacing:.2px}
    .sub{font-size:12px;color:#9bb0e0}
    .card .tools{display:flex;gap:8px}
    .iconbtn{border:1px solid rgba(255,255,255,.14);background:#0d1530;border-radius:10px;padding:8px;cursor:pointer}
    .favorites{display:flex;gap:8px;flex-wrap:wrap}
    .fav{background:#0d1530;border:1px solid rgba(255,255,255,.08);padding:8px 10px;border-radius:999px;font-size:12px}
    footer{margin-top:26px;font-size:12px;color:#8ea0d2;display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .small{font-size:12px;color:#90a0c7}
    .ad{background:repeating-linear-gradient(45deg, rgba(255,255,255,.06), rgba(255,255,255,.06) 10px, rgba(255,255,255,.03) 10px, rgba(255,255,255,.03) 20px); border:1px dashed rgba(255,255,255,.2); border-radius:14px; color:#bfc8df; display:grid; place-items:center; height:90px; font-size:12px}
    .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#111b32;border:1px solid rgba(255,255,255,.14);color:#fff;padding:10px 14px;border-radius:10px;opacity:0;pointer-events:none;transition:opacity .25s ease}
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1 id="appTitle">Ø£Ø³Ù…Ø§Ø¡ Ù„Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ø£Ù„ÙŠÙØ© â€” Ù…Ø®ØµÙ‘ØµØ©</h1>
          <div class="tag" id="appTag">ØªÙˆÙ„Ù‘Ø¯ Ø£ÙÙƒØ§Ø±Ù‹Ø§ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ ÙˆØ§Ù„Ø¹Ù…Ø± ÙˆØ§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</div>
        </div>
      </div>

      <div class="langpick">
        <label for="lang" class="small" id="labelLang">Ø§Ù„Ù„ØºØ©</label>
        <select id="lang" aria-label="Choose language">
          <option value="fr">FR</option>
          <option value="en">EN</option>
          <option value="de">DE</option>
          <option value="es">ES</option>
          <option value="zh">ä¸­æ–‡</option>
          <option value="hi">HI</option>
          <option value="ar" selected>AR</option>
          <option value="bn">BN</option>
        </select>
      </div>

      <div style="min-width:180px;flex:0 0 180px">
        <div style="margin-top:18px">
          <!-- Bloc pub en-tÃªte (remplace data-ad-slot par ton ID) -->
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-9411950027978678"
               data-ad-slot="REPLACE_WITH_SLOT_HEADER"
               data-ad-format="horizontal"
               data-full-width-responsive="true"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
      </div>
    </header>

    <main class="panel">
      <section class="pad" aria-label="Form">
        <div class="controls">
          <div>
            <label id="labelSpecies" for="species">Ø§Ù„Ù†ÙˆØ¹</label>
            <select id="species" aria-label="Species">
              <option value="chien">ğŸ¶ ÙƒÙ„Ø¨</option>
              <option value="chat">ğŸ± Ù‚Ø·</option>
              <option value="oiseau">ğŸ¦ Ø·Ø§Ø¦Ø±</option>
              <option value="lapin">ğŸ° Ø£Ø±Ù†Ø¨</option>
              <option value="cheval">ğŸ´ Ø­ØµØ§Ù†</option>
              <option value="reptile">ğŸ¦ Ø²Ø§Ø­Ù</option>
              <option value="rongeur">ğŸ­ Ù‚Ø§Ø±Ø¶</option>
              <option value="poisson">ğŸŸ Ø³Ù…ÙƒØ©</option>
              <option value="autre">âœ¨ Ø£Ø®Ø±Ù‰</option>
            </select>
          </div>
          <div>
            <label id="labelAge" for="age">Ø§Ù„Ø¹Ù…Ø±</label>
            <div class="row">
              <input id="age" type="number" min="0" step="0.1" placeholder="Ù…Ø«Ù„Ø§Ù‹ 2" aria-label="Age"/>
              <select id="ageUnit" aria-label="Age unit">
                <option value="years">Ø³Ù†ÙˆØ§Øª</option>
                <option value="months">Ø£Ø´Ù‡Ø±</option>
              </select>
            </div>
          </div>
          <div>
            <label id="labelSex" for="sex">Ø§Ù„Ø¬Ù†Ø³ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <select id="sex">
              <option value="inconnu">ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</option>
              <option value="femelle">Ø£Ù†Ø«Ù‰</option>
              <option value="mÃ¢le">Ø°ÙƒØ±</option>
            </select>
          </div>
          <div>
            <label id="labelStyles">Ù†Ù…Ø· Ø§Ù„Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <div id="styles" class="chips" role="group" aria-label="Styles">
              <div class="chip" data-style="mignon" id="chip-style-mignon">Ù„Ø·ÙŠÙ</div>
              <div class="chip" data-style="classique" id="chip-style-classique">ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ</div>
              <div class="chip" data-style="nature" id="chip-style-nature">Ø·Ø¨ÙŠØ¹ÙŠ</div>
              <div class="chip" data-style="mythologique" id="chip-style-mythologique">Ø£Ø³Ø·ÙˆØ±ÙŠ</div>
              <div class="chip" data-style="fantaisie" id="chip-style-fantaisie">Ø®ÙŠØ§Ù„ÙŠ</div>
              <div class="chip" data-style="court" id="chip-style-court">Ù‚ØµÙŠØ± (â‰¤2 Ù…Ù‚Ø·Ø¹)</div>
            </div>
          </div>
          <div class="col-span-2">
            <label id="labelTraits">Ø§Ù„Ø³Ù…Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <div id="traits" class="chips" role="group" aria-label="Traits">
              <div class="chip" data-trait="joueur" id="chip-trait-joueur">Ù„Ø¹ÙˆØ¨</div>
              <div class="chip" data-trait="calme" id="chip-trait-calme">Ù‡Ø§Ø¯Ø¦</div>
              <div class="chip" data-trait="curieux" id="chip-trait-curieux">ÙØ¶ÙˆÙ„ÙŠ</div>
              <div class="chip" data-trait="brave" id="chip-trait-brave">Ø´Ø¬Ø§Ø¹</div>
              <div class="chip" data-trait="malin" id="chip-trait-malin">Ø°ÙƒÙŠ</div>
              <div class="chip" data-trait="Ø¯oux" id="chip-trait-doux">Ø±Ù‚ÙŠÙ‚</div>
              <div class="chip" data-trait="royal" id="chip-trait-royal">Ù†Ø¨ÙŠÙ„</div>
              <div class="chip" data-trait="sage" id="chip-trait-sage">Ø­ÙƒÙŠÙ…</div>
            </div>
          </div>
          <div class="col-span-2">
            <label id="labelPhoto">ØµÙˆØ±Ø© Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„Ø£Ù„ÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)</label>
            <div class="filedrop" id="filedrop">
              <div class="inner">
                <div class="thumb" id="thumb" aria-hidden="true">ğŸ“·</div>
                <div>
                  <strong id="photoDrop">Ø§Ø³Ø­Ø¨ ØµÙˆØ±Ø© Ù‡Ù†Ø§</strong> <span id="photoOr">Ø£Ùˆ</span> <label for="file" id="photoClick" style="text-decoration:underline;cursor:pointer">Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±</label>
                  <input id="file" type="file" accept="image/*" />
                  <div class="hint" id="photoHint">Ù„Ù† ÙŠØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© â€” ØªØ¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ. ØªØ³Ø§Ø¹Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø³Ø§Ø¦Ø¯Ø© Ø¹Ù„Ù‰ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª.</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="actions">
          <button class="btn primary" id="generate">Ø§Ù‚ØªØ±Ø­ Ø£Ø³Ù…Ø§Ø¡</button>
          <button class="btn ghost" id="randomize">Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
          <button class="btn ghost" id="clear">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†</button>
        </div>
      </section>

      <section class="results" aria-live="polite">
        <div style="margin-bottom:10px" class="small"><span id="suggestionsTitle">Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</span> (<span id="count">0</span>)</div>
        <div class="grid" id="grid"></div>
        <div style="margin-top:14px" class="small" id="favoritesTitle">Ø§Ù„Ù…ÙØ¶Ù„Ø©</div>
        <div class="favorites" id="favorites"></div>
        <div style="margin-top:18px">
          <!-- Bloc pub bas (remplace data-ad-slot) -->
          <ins class="adsbygoogle"
               style="display:block"
               data-ad-client="ca-pub-9411950027978678"
               data-ad-slot="REPLACE_WITH_SLOT_BOTTOM"
               data-ad-format="horizontal"
               data-full-width-responsive="true"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
      </section>
    </main>

    <footer>
      <div id="footerLeft">Â© <span id="year"></span> â€” ØªØ·Ø¨ÙŠÙ‚ Ø«Ø§Ø¨Øª ØµØºÙŠØ±. Ø§Ù„ØµÙˆØ± ØªØ¨Ù‚Ù‰ Ù…Ø­Ù„ÙŠÙ‹Ø§. <a href="#" id="exportFavs">ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ÙØ¶Ù„Ø©</a></div>
      <div><a href="#" id="share">Ù…Ø´Ø§Ø±ÙƒØ© Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯</a></div>
    </footer>
  </div>

  <div class="toast" id="toast">ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ”</div>

  <script>
    /* ===== Config / i18n / helpers ===== */
    const CONFIG = {
      // Remplace si besoin par lâ€™URL exacte de ton API Vercel
      apiEndpoint: 'https://petnames-api.vercel.app/api/generate'
    };

    const I18N = {
      ar:{dir:'rtl',metaTitle:'Ø£Ø³Ù…Ø§Ø¡ Ù„Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ø£Ù„ÙŠÙØ© â€” Ù…Ø®ØµÙ‘ØµØ©',metaDesc:'Ø£Ø¯Ø§Ø© ØµØºÙŠØ±Ø© ØªÙ‚ØªØ±Ø­ Ø£Ø³Ù…Ø§Ø¡Ù‹ Ù„Ø­ÙŠÙˆØ§Ù†Ùƒ Ø§Ù„Ø£Ù„ÙŠÙ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ ÙˆØ§Ù„Ø¹Ù…Ø± ÙˆØµÙˆØ±Ø© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©. ØªØ¹Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­.',appTitle:'Ø£Ø³Ù…Ø§Ø¡ Ù„Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ø£Ù„ÙŠÙØ© â€” Ù…Ø®ØµÙ‘ØµØ©',appTag:'ØªÙˆÙ„Ù‘Ø¯ Ø£ÙÙƒØ§Ø±Ù‹Ø§ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹ ÙˆØ§Ù„Ø¹Ù…Ø± ÙˆØ§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)',labelLang:'Ø§Ù„Ù„ØºØ©',labelSpecies:'Ø§Ù„Ù†ÙˆØ¹',species:{chien:'ğŸ¶ ÙƒÙ„Ø¨',chat:'ğŸ± Ù‚Ø·',oiseau:'ğŸ¦ Ø·Ø§Ø¦Ø±',lapin:'ğŸ° Ø£Ø±Ù†Ø¨',cheval:'ğŸ´ Ø­ØµØ§Ù†',reptile:'ğŸ¦ Ø²Ø§Ø­Ù',rongeur:'ğŸ­ Ù‚Ø§Ø±Ø¶',poisson:'ğŸŸ Ø³Ù…ÙƒØ©',autre:'âœ¨ Ø£Ø®Ø±Ù‰'},labelAge:'Ø§Ù„Ø¹Ù…Ø±',agePlaceholder:'Ù…Ø«Ù„Ø§Ù‹ 2',unitYears:'Ø³Ù†ÙˆØ§Øª',unitMonths:'Ø£Ø´Ù‡Ø±',labelSex:'Ø§Ù„Ø¬Ù†Ø³ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)',sex:{inconnu:'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',femelle:'Ø£Ù†Ø«Ù‰','mÃ¢le':'Ø°ÙƒØ±'},labelStyles:'Ù†Ù…Ø· Ø§Ù„Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)',styles:{mignon:'Ù„Ø·ÙŠÙ',classique:'ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠ',nature:'Ø·Ø¨ÙŠØ¹ÙŠ',mythologique:'Ø£Ø³Ø·ÙˆØ±ÙŠ',fantaisie:'Ø®ÙŠØ§Ù„ÙŠ',court:'Ù‚ØµÙŠØ± (â‰¤2 Ù…Ù‚Ø·Ø¹)'},labelTraits:'Ø§Ù„Ø³Ù…Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)',traits:{joueur:'Ù„Ø¹ÙˆØ¨',calme:'Ù‡Ø§Ø¯Ø¦',curieux:'ÙØ¶ÙˆÙ„ÙŠ',brave:'Ø´Ø¬Ø§Ø¹',malin:'Ø°ÙƒÙŠ',doux:'Ø±Ù‚ÙŠÙ‚',royal:'Ù†Ø¨ÙŠÙ„',sage:'Ø­ÙƒÙŠÙ…'},labelPhoto:'ØµÙˆØ±Ø© Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„Ø£Ù„ÙŠÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)',photoDrop:'Ø§Ø³Ø­Ø¨ ØµÙˆØ±Ø© Ù‡Ù†Ø§',photoOr:'Ø£Ùˆ',photoClick:'Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±',photoHint:'Ù„Ù† ÙŠØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© â€” ØªØ¨Ù‚Ù‰ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ. ØªØ³Ø§Ø¹Ø¯ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø³Ø§Ø¦Ø¯Ø© Ø¹Ù„Ù‰ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª.',btnGenerate:'Ø§Ù‚ØªØ±Ø­ Ø£Ø³Ù…Ø§Ø¡',btnRandomize:'Ø¹Ø´ÙˆØ§Ø¦ÙŠ',btnClear:'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†',suggestionsTitle:'Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª',favoritesTitle:'Ø§Ù„Ù…ÙØ¶Ù„Ø©',footerLeftPrefix:'Â©',footerLeftText:'â€” ØªØ·Ø¨ÙŠÙ‚ Ø«Ø§Ø¨Øª ØµØºÙŠØ±. Ø§Ù„ØµÙˆØ± ØªØ¨Ù‚Ù‰ Ù…Ø­Ù„ÙŠÙ‹Ø§.',exportFavs:'ØªØµØ¯ÙŠØ± Ø§Ù„Ù…ÙØ¶Ù„Ø©',share:'Ù…Ø´Ø§Ø±ÙƒØ© Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯',toastCopied:'ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ”',toolCopy:'Ù†Ø³Ø®',toolFav:'Ù…ÙØ¶Ù„Ø©',toolCard:'Ø¨Ø·Ø§Ù‚Ø©',cardSubtitle:'Ø§Ø³Ù… Ù…Ù‚ØªØ±Ø­ Ù„Ø±ÙÙŠÙ‚Ùƒ',cardFooter:'petnames.one â€” Ø¯ÙˆÙ† Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±',ageMonths:n=>`${n} Ø´Ù‡Ø±Ù‹Ø§`,ageYears:y=>`${y} Ø³Ù†Ø©`},
      en:{dir:'ltr',metaTitle:'Pet names â€” tailored',metaDesc:'A tiny tool suggesting names for your pet based on species, age, and an optional photo. 100% in-browser.',appTitle:'Pet names â€” tailored',appTag:'Generates ideas based on species, age, and photo (optional)',labelLang:'Language',labelSpecies:'Species',species:{chien:'ğŸ¶ Dog',chat:'ğŸ± Cat',oiseau:'ğŸ¦ Bird',lapin:'ğŸ° Rabbit',cheval:'ğŸ´ Horse',reptile:'ğŸ¦ Reptile',rongeur:'ğŸ­ Rodent',poisson:'ğŸŸ Fish',autre:'âœ¨ Other'},labelAge:'Age',agePlaceholder:'e.g. 2',unitYears:'years',unitMonths:'months',labelSex:'Sex (optional)',sex:{inconnu:'Unknown',femelle:'Female','mÃ¢le':'Male'},labelStyles:'Name style (optional)',styles:{mignon:'Cute',classique:'Classic',nature:'Nature',mythologique:'Mythologic',fantaisie:'Fantasy',court:'Short (â‰¤2 syl.)'},labelTraits:'Personality (optional)',traits:{joueur:'Playful',calme:'Calm',curieux:'Curious',brave:'Brave',malin:'Clever',doux:'Gentle',royal:'Regal',sage:'Wise'},labelPhoto:'Pet photo (optional)',photoDrop:'Drop an image here',photoOr:'or',photoClick:'click to choose',photoHint:'The image is not uploaded â€” it stays on your device. Dominant colors help refine ideas.',btnGenerate:'Generate names',btnRandomize:'Randomize',btnClear:'Reset',suggestionsTitle:'Suggestions',favoritesTitle:'Favorites',footerLeftPrefix:'Â©',footerLeftText:'â€” Tiny static app. Images stay local.',exportFavs:'Export favorites',share:'Share this setup',toastCopied:'Copied âœ”',toolCopy:'Copy',toolFav:'Favorite',toolCard:'Card',cardSubtitle:'Suggested name for your companion',cardFooter:'petnames.one â€” offline, no image upload',ageMonths:n=>`${n} months`,ageYears:y=>`${y} years`}
    };

    const $  = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const state = {
      image:null,
      imageColors:[],
      favorites: JSON.parse(localStorage.getItem('petname.favs')||'[]'),
      lang:'ar',
      lastResults:[],
      lastForm:null,
      labels: I18N.ar
    };

    function applyI18n(lang){
      state.lang = lang;
      state.labels = I18N[lang] || I18N.ar;
      try{ localStorage.setItem('petname.lang', lang); }catch{}
      document.documentElement.lang = lang;
      document.documentElement.dir  = state.labels.dir || (lang==='ar'?'rtl':'ltr');

      $('#metaTitle').textContent = state.labels.metaTitle; document.title = state.labels.metaTitle;
      $('#metaDesc').setAttribute('content', state.labels.metaDesc);
      $('#appTitle').textContent = state.labels.appTitle;
      $('#appTag').textContent   = state.labels.appTag;
      $('#labelLang').textContent = state.labels.labelLang;

      for(const [val,text] of Object.entries(state.labels.species)){
        const opt = $(`#species option[value="${CSS.escape(val)}"]`);
        if(opt) opt.textContent = text;
      }
      $('#labelSpecies').textContent = state.labels.labelSpecies;

      $('#labelAge').textContent = state.labels.labelAge;
      $('#age').setAttribute('placeholder', state.labels.agePlaceholder);
      $('#ageUnit option[value="years"]').textContent  = state.labels.unitYears;
      $('#ageUnit option[value="months"]').textContent = state.labels.unitMonths;

      $('#labelSex').textContent = state.labels.labelSex;
      for(const [val,text] of Object.entries(state.labels.sex)){
        const opt = $(`#sex option[value="${CSS.escape(val)}"]`);
        if(opt) opt.textContent = text;
      }

      $('#labelStyles').textContent = state.labels.labelStyles;
      for(const [k,t] of Object.entries(state.labels.styles)){
        const el = $(`#chip-style-${k}`); if(el) el.textContent = t;
      }
      $('#labelTraits').textContent = state.labels.labelTraits;
      for(const [k,t] of Object.entries(state.labels.traits)){
        const el = $(`#chip-trait-${k}`); if(el) el.textContent = t;
      }

      $('#labelPhoto').textContent = state.labels.labelPhoto;
      $('#photoDrop').textContent  = state.labels.photoDrop;
      $('#photoOr').textContent    = state.labels.photoOr;
      $('#photoClick').textContent = state.labels.photoClick;
      $('#photoHint').textContent  = state.labels.photoHint;

      $('#generate').textContent  = state.labels.btnGenerate;
      $('#randomize').textContent = state.labels.btnRandomize;
      $('#clear').textContent     = state.labels.btnClear;

      $('#suggestionsTitle').textContent = state.labels.suggestionsTitle;
      $('#favoritesTitle').textContent   = state.labels.favoritesTitle;
      $('#toast').textContent            = state.labels.toastCopied;

      $('#footerLeft').innerHTML =
        `${state.labels.footerLeftPrefix||'Â©'} <span id="year"></span> ${state.labels.footerLeftText||''} <a href="#" id="exportFavs">${state.labels.exportFavs||''}</a>`;
      $('#year').textContent = new Date().getFullYear();

      if(state.lastResults.length && state.lastForm){
        renderResults(state.lastResults, state.lastForm);
      }
    }

    const toast = (msg)=>{ const t=$('#toast'); t.textContent = msg || state.labels.toastCopied; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1200); };
    const setCount = n => $('#count').textContent = String(n);

    function setupChips(sel){ const cont=$(sel); cont.addEventListener('click',e=>{ const chip=e.target.closest('.chip'); if(!chip) return; chip.classList.toggle('active'); }); }
    setupChips('#styles'); setupChips('#traits');

    // Drag & drop image
    const fileInput=$('#file'), filedrop=$('#filedrop'), thumb=$('#thumb');
    function preview(file){ if(!file) return; const r=new FileReader(); r.onload=()=>{ state.image=r.result; const img=new Image(); img.onload=()=>{ thumb.innerHTML=''; thumb.appendChild(img); extractDominantColors(img).then(c=>state.imageColors=c); }; img.src=r.result; }; r.readAsDataURL(file); }
    fileInput.addEventListener('change', e=> preview(e.target.files?.[0]));
    ;['dragenter','dragover'].forEach(ev=> filedrop.addEventListener(ev,(e)=>{e.preventDefault(); filedrop.style.borderColor='#6fb4ff';}));
    ;['dragleave','drop'].forEach(ev=> filedrop.addEventListener(ev,(e)=>{e.preventDefault(); filedrop.style.borderColor='rgba(255,255,255,.08)';}));
    filedrop.addEventListener('drop', e=>{ const f=e.dataTransfer.files?.[0]; if(f && f.type.startsWith('image/')) preview(f); });

    // Form helpers
    function getForm(){
      const species=$('#species').value;
      const ageVal=parseFloat($('#age').value||'0');
      const ageMonths=$('#ageUnit').value==='years'?Math.round(ageVal*12):Math.round(ageVal);
      const sex=$('#sex').value;
      const styles=$$('#styles .chip.active').map(c=>c.dataset.style);
      const traits=$$('#traits .chip.active').map(c=>c.dataset.trait);
      return { species, ageMonths, sex, styles, traits, colorHints: state.imageColors, hasImage: !!state.image };
    }
    function randomize(){
      const speciesOpts=['chien','chat','oiseau','lapin','cheval','reptile','rongeur','poisson','autre'];
      $('#species').value=pick(speciesOpts); $('#age').value=(Math.random()*8).toFixed(1);
      $('#ageUnit').value=Math.random()>.5?'years':'months';
      $('#sex').value=pick(['inconnu','femelle','mÃ¢le']);
      ['#styles','#traits'].forEach(sel=>{ $$(sel+' .chip').forEach(c=>c.classList.remove('active')); $$(sel+' .chip').filter(()=>Math.random()>.65).forEach(c=>c.classList.add('active')); });
    }
    $('#randomize').addEventListener('click', ()=> randomize());
    $('#clear').addEventListener('click', ()=>{ location.href = location.pathname; });

    // GÃ©nÃ©ration (API) avec fallback local
    $('#generate').addEventListener('click', async ()=>{
      const form=getForm();
      const names = await generateRemote(form).catch(()=>generateLocal(form));
      state.lastResults=names; state.lastForm=form; renderResults(names, form);
    });

    async function generateRemote(form){
      if(!CONFIG.apiEndpoint) throw new Error('No API endpoint');
      const res = await fetch(CONFIG.apiEndpoint, {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify(form)
      });
      if(!res.ok) throw new Error('Bad response');
      const data = await res.json();
      if(!Array.isArray(data.names)) throw new Error('Invalid payload');
      return data.names.slice(0,24);
    }

    // Fallback local simple
    function generateLocal({species, ageMonths, sex, styles, traits, colorHints}){
      const pool=buildSyllablePool(species, styles);
      const targetSyll = styles.includes('court')?[1,2]:[1,2,2,3];
      const ageTag = ageMonths<=12?'bÃ©bÃ©':ageMonths<72?'jeune':'adulte';
      const vibe=[...styles,...traits,ageTag,sex];
      const colorNames=colorHintsToNames(colorHints);
      const results=new Set(); let fails=0;
      while(results.size<18 && fails<200){
        const sylCount=pick(targetSyll);
        let name='';
        for(let i=0;i<sylCount;i++) name+=pick(pool);
        name=postProcess(name, species, vibe);
        if(colorNames.length && Math.random()>0.7){ name=blend(name, pick(colorNames)); }
        name=name.charAt(0).toUpperCase()+name.slice(1);
        if(/^[A-Za-zÃ€-Ã¿\-]{3,15}$/.test(name)) results.add(name); else fails++;
      }
      const themed=themedNames(species, styles, colorHints, sex);
      themed.forEach(n=>results.add(n));
      return Array.from(results).slice(0,24);
    }

    function buildSyllablePool(species, styles){
      const base=['lo','la','li','lu','ly','no','na','ne','ni','nu','mi','ma','mo','mu','ka','ko','ki','ku','zo','za','ze','zi','zu','ru','ra','re','ri','ro','ta','te','ti','to','tu','po','pa','pe','pi','pu','fa','fe','fi','fo','ga','go','gi','gu','ya','yo','yu','bo','ba','be','bi','bu','cha','cho','chi','chu','sha','sho','shi','shu','co','ca','ce','ci','cu','do','da','de','di','du','el','en','ar','is','or','us','an','in','on','eu','Ã©','lae','rae','lyr','my','ny','ae','ia','eo'];
      const cat=['mi','min','ny','nya','roux','rou','cha','cha','tou','tou','plu','plume','shi','mou','pel','gra','gris','nois','sette'];
      const dog=['rex','max','kai','kao','bao','brun','dog','wolf','ran','bark','nix','fox','zo','zor','bal','kan','leo'];
      const bird=['pi','pio','twi','rio','ari','lark','azur','ciel','plu','aer','avel'];
      const rabbit=['lap','pin','nois','ette','coco','neige','flop','pom','pon','nini'];
      const horse=['gal','lop','ael','mane','crin','siro','safir','lune','sole','vento'];
      const reptile=['sli','ther','sco','yra','ona','gex','gla','dru'];
      const rodent=['nois','ette','miot','mimi','pix','pip','tika','nux'];
      const fish=['na','ri','mo','ma','mar','bril','azur','coral','nemo','bub'];
      const other=['zeph','lyr','neo','or','el','aer','myr','quill'];
      let speciesPool=base;
      switch(species){
        case 'chat':    speciesPool=base.concat(cat); break;
        case 'chien':   speciesPool=base.concat(dog); break;
        case 'oiseau':  speciesPool=base.concat(bird); break;
        case 'lapin':   speciesPool=base.concat(rabbit); break;
        case 'cheval':  speciesPool=base.concat(horse); break;
        case 'reptile': speciesPool=base.concat(reptile); break;
        case 'rongeur': speciesPool=base.concat(rodent); break;
        case 'poisson': speciesPool=base.concat(fish); break;
        default:        speciesPool=base.concat(other); break;
      }
      if(styles.includes('mythologique')) speciesPool = speciesPool.concat(['aen','aeon','thor','odin','isis','hera','zeus','posei','dion','ra','yor']);
      if(styles.includes('nature'))        speciesPool = speciesPool.concat(['flor','luz','sol','lune','neige','mousse','Ã©cor','ciel','roc','bois','vent']);
      if(styles.includes('fantaisie'))     speciesPool = speciesPool.concat(['fae','lyn','wyn','ari','syl','drac','pyro','hydra','glen','vale']);
      if(styles.includes('classique'))     speciesPool = speciesPool.concat(['bella','louis','lÃ©o','lena','milo','nina','nora','paul','tom','jade','lila']);
      return speciesPool;
    }

    function postProcess(name, species, vibe){
      name = name.replace(/([a-zÃ©Ã Ã¨])\1{2,}/gi,'$1$1');
      name = name.replace(/([aeiouy])([aeiouy])/gi,'$1');
      if(species==='chat'||species==='chien'){ name = name.replace(/ny|nya/gi,'nya'); }
      if(vibe.includes('mignon')){ if(!/[ou]$/.test(name)) name += pick(['ou','u','i']); }
      if(vibe.includes('court')){ name = name.replace(/([a-z]{1,3}).*/i,'$1'); if(name.length<3) name += pick(['a','i','o']); }
      return name;
    }

    function colorHintsToNames(hints){
      const map={ ambre:['Ambre','Miel','Caramel','Cannelle','Moka'], neige:['Neige','Perle','Lumi','Ivory','Aurore'], Ã©bÃ¨ne:['Ã‰bÃ¨ne','Sombrelune','Onyx','RÃ©glisse'], cuivre:['Cuivre','Roux','ChÃ¢taigne','Noisette','Flamme'], saphir:['Saphir','Azura','Bleuet','Ciel'], jade:['Jade','Verdi','Mousse','Ã‰meraude'], corail:['Corail','RosÃ©e','PÃªche','SaumÙˆÙ†'] };
      const out=[]; hints.forEach(h=>{ (map[h]||[]).forEach(n=>out.push(n)); }); return out;
    }

    function themedNames(species, styles, colorHints, sex){
      const bank=[];
      if(styles.includes('classique')) bank.push(...(sex==='femelle'?['Luna','Bella','Lily','Nina','Jade']:['Milo','LÃ©o','Oscar','Toby','Hugo']));
      if(styles.includes('mythologique')) bank.push(...['HermÃ¨s','GaÃ¯a','Iris','Nox','Thor','HÃ©ra','AthÃ©na','Orion']);
      if(styles.includes('nature')) bank.push(...['Bambou','Brise','Flocon','RosÃ©e','Ruisseau','Brume']);
      if(colorHints.includes('ambre')) bank.push('Canelle','Moka');
      if(species==='oiseau') bank.push('Plume','Azur');
      if(species==='cheval') bank.push('TempÃªte','Galop');
      if(species==='poisson') bank.push('Bubble','Coral');
      return shuffle(bank).slice(0,6);
    }

    async function extractDominantColors(img){
      const canvas=document.createElement('canvas');
      const ctx=canvas.getContext('2d',{willReadFrequently:true});
      const w=canvas.width=120; const h=canvas.height=Math.round(img.height*(w/img.width));
      ctx.drawImage(img,0,0,w,h);
      const data=ctx.getImageData(0,0,w,h).data;
      let r=0,g=0,b=0,count=0,sumL=0;
      for(let i=0;i<data.length;i+=16){
        const R=data[i],G=data[i+1],B=data[i+2],a=data[i+3];
        if(a<180) continue; r+=R; g+=G; b+=B; count++; sumL+=0.2126*R+0.7152*G+0.0722*B;
      }
      if(!count) return [];
      r=Math.round(r/count); g=Math.round(g/count); b=Math.round(b/count);
      const avgL=sumL/count; const hue=rgbToHue(r,g,b);
      const colors=[];
      if(avgL>210) colors.push('neige');
      if(avgL<60)  colors.push('Ã©bÃ¨ne');
      if(hue>=15&&hue<45)  colors.push('ambre');
      if(hue>=45&&hue<90)  colors.push('jade');
      if(hue>=190&&hue<250) colors.push('saphir');
      if(hue>=330||hue<15)  colors.push('corail');
      if(hue>=15&&hue<25)   colors.push('cuivre');
      return Array.from(new Set(colors));
    }
    function rgbToHue(r,g,b){
      r/=255; g/=255; b/=255; const max=Math.max(r,g,b),min=Math.min(r,g,b),d=max-min; if(d===0) return 0;
      let h; switch(max){ case r: h=(g-b)/d+(g<b?6:0); break; case g: h=(b-r)/d+2; break; case b: h=(r-g)/d+4; break; }
      h/=6; return Math.round(h*360);
    }

    function renderResults(names, form){
      const grid=$('#grid'); grid.innerHTML='';
      names.forEach(n=>{ grid.appendChild(nameCard(n, form)); });
      setCount(names.length); renderFavs();
      const params=new URLSearchParams(location.search);
      params.set('species',form.species); params.set('age',form.ageMonths); params.set('sex',form.sex);
      if(form.styles.length) params.set('styles',form.styles.join(','));
      if(form.traits.length) params.set('traits',form.traits.join(','));
      params.set('lang',state.lang);
      history.replaceState({},'',`${location.pathname}?${params.toString()}`);
    }

    function nameCard(name, form){
      const card=document.createElement('div'); card.className='card';
      const left=document.createElement('div');
      left.innerHTML = `<div class="name">${escapeHtml(name)}</div><div class="sub">${emojiFor(form.species)} ${escapeHtml(displaySpecies(form.species))} â€¢ ${humanAge(form.ageMonths)} â€¢ ${escapeHtml(displaySex(form.sex))}</div>`;
      const tools=document.createElement('div'); tools.className='tools';
      const btnCopy=iconButton('ğŸ“‹',state.labels.toolCopy||'Ù†Ø³Ø®');
      btnCopy.addEventListener('click',()=>{ navigator.clipboard.writeText(name); toast(); });
      const btnFav=iconButton(isFav(name)?'â˜…':'â˜†',state.labels.toolFav||'Ù…ÙØ¶Ù„Ø©');
      btnFav.addEventListener('click',()=>{ toggleFav(name); btnFav.textContent=isFav(name)?'â˜…':'â˜†'; renderFavs(); });
      const btnCard=iconButton('ğŸ–¼ï¸',state.labels.toolCard||'Ø¨Ø·Ø§Ù‚Ø©');
      btnCard.addEventListener('click',()=>{ downloadCard(name); });
      card.append(left, Object.assign(document.createElement('div'),{className:'tools'}, tools));
      tools.append(btnCopy,btnFav,btnCard);
      return card;
    }

    function iconButton(txt,title){ const b=document.createElement('button'); b.className='iconbtn'; b.textContent=txt; b.title=title; return b; }
    function emojiFor(s){ return { chien:'ğŸ¶', chat:'ğŸ±', oiseau:'ğŸ¦', lapin:'ğŸ°', cheval:'ğŸ´', reptile:'ğŸ¦', rongeur:'ğŸ­', poisson:'ğŸŸ', autre:'âœ¨' }[s] || 'ğŸ¾'; }
    function displaySpecies(v){ const map=I18N[state.lang]?.species||{}; return map[v]?map[v].replace(/^\p{Emoji_Presentation}\s*/u,''):v; }
    function displaySex(v){ return (I18N[state.lang]?.sex||{})[v] || v; }
    function humanAge(m){ if(m<12) return (I18N[state.lang]?.ageMonths||((n)=>n+' Ø´Ù‡Ø±Ù‹Ø§'))(m); const y=(Math.round((m/12)*10)/10); return (I18N[state.lang]?.ageYears||((yy)=>yy+' Ø³Ù†Ø©'))(y); }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g,(c)=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}[c])); }

    function isFav(n){ return state.favorites.includes(n); }
    function toggleFav(n){ const i=state.favorites.indexOf(n); if(i>=0) state.favorites.splice(i,1); else state.favorites.push(n); persistFavs(); }
    function persistFavs(){ localStorage.setItem('petname.favs', JSON.stringify(state.favorites)); }
    function renderFavs(){ const cont=$('#favorites'); cont.innerHTML=''; state.favorites.forEach(n=>{ const s=document.createElement('span'); s.className='fav'; s.textContent=n; cont.appendChild(s); }); }
    document.addEventListener('click',(e)=>{ const a=e.target.closest('#exportFavs'); if(a){ e.preventDefault(); const blob=new Blob([state.favorites.join('\n')],{type:'text/plain'}); const url=URL.createObjectURL(blob); const a2=document.createElement('a'); a2.href=url; a2.download='favorites.txt'; a2.click(); URL.revokeObjectURL(url); }});
    $('#share')?.addEventListener('click',(e)=>{ e.preventDefault(); navigator.clipboard.writeText(location.href).then(()=>toast(state.labels.toastCopied)); });

    function downloadCard(name){
      const canvas=document.createElement('canvas'); const w=900,h=500; canvas.width=w; canvas.height=h; const ctx=canvas.getContext('2d');
      const grad=ctx.createLinearGradient(0,0,w,h); grad.addColorStop(0,'#0d1530'); grad.addColorStop(1,'#0b1126'); ctx.fillStyle=grad; ctx.fillRect(0,0,w,h);
      if(state.image){ const img=new Image(); img.onload=()=>{ drawCard(ctx,w,h,img,name); save(); }; img.src=state.image; } else { drawCard(ctx,w,h,null,name); save(); }
      function save(){ const a=document.createElement('a'); a.download=`${name}.png`; a.href=canvas.toDataURL('image/png'); a.click(); }
    }
    function drawCard(ctx,w,h,img,name){
      if(img){ const r=180; const x=w-220, y=140; roundImage(ctx,img,x,y,r); }
      ctx.fillStyle='#fff'; ctx.font='700 72px Inter, sans-serif'; ctx.fillText(name,60,200);
      ctx.font='400 22px Inter, sans-serif'; ctx.fillStyle='rgba(255,255,255,.8)'; ctx.fillText(I18N[state.lang]?.cardSubtitle||'',60,240);
      ctx.font='400 16px Inter, sans-serif'; ctx.fillStyle='rgba(255,255,255,.55)'; ctx.fillText(I18N[state.lang]?.cardFooter||'',60,280);
    }
    function roundImage(ctx,img,x,y,r){ ctx.save(); ctx.beginPath(); ctx.arc(x+r,y+r,r,0,Math.PI*2); ctx.closePath(); ctx.clip(); const size=Math.min(img.width,img.height); ctx.drawImage(img,(img.width-size)/2,(img.height-size)/2,size,size,x,y,r*2,r*2); ctx.restore(); }
    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
    function shuffle(arr){ return arr.map(a=>[Math.random(),a]).sort((a,b)=>a[0]-b[0]).map(a=>a[1]); }

    // Init
    document.addEventListener('DOMContentLoaded', ()=>{
      $('#year').textContent=new Date().getFullYear();
      renderFavs();
      applyI18n('ar');
      const q=new URLSearchParams(location.search);
      if(q.get('species')) $('#species').value=q.get('species');
      if(q.get('age')){ const m=Number(q.get('age')); if(m>=12){ $('#age').value=(m/12).toFixed(1); $('#ageUnit').value='years'; } else { $('#age').value=m; $('#ageUnit').value='months'; } }
      if(q.get('sex')) $('#sex').value=q.get('sex');
      if(q.get('styles')) q.get('styles').split(',').forEach(s=>{ const c=$(`#styles .chip[data-style="${CSS.escape(s)}"]`); c && c.classList.add('active'); });
      if(q.get('traits')) q.get('traits').split(',').forEach(t=>{ const c=$(`#traits .chip[data-trait="${CSS.escape(t)}"]`); c && c.classList.add('active'); });
      $('#lang').value='ar';
    });
  </script>

  <!-- Switcher de langue (par dossier) -->
  <script>
    (function(){
      const SUPPORTED_LANGS = ["fr","en","de","es","zh","hi","ar","bn"];
      function projectRoot(){
        const parts = location.pathname.split("/");
        if(parts[parts.length-1] === "") parts.pop();
        const last = (parts[parts.length-1]||"").toLowerCase();
        if (SUPPORTED_LANGS.includes(last)) parts.pop();
        let root = parts.join("/");
        if(root === "") root = "/";
        if(!root.endsWith("/")) root += "/";
        return root; // ex: "/petnames/"
      }
      function buildLangUrl(nextLang){
        if(!SUPPORTED_LANGS.includes(nextLang)) nextLang = "en";
        const keepKeys = ["species","age","sex","styles","traits"];
        const src = new URLSearchParams(location.search);
        const kept = new URLSearchParams();
        keepKeys.forEach(k=>{ if(src.has(k)) kept.set(k, src.get(k)); });
        const qs = kept.toString();
        return projectRoot() + nextLang + "/" + (qs? ("?"+qs) : "");
      }
      document.addEventListener("DOMContentLoaded", ()=>{
        const sel = document.querySelector("#lang");
        if(!sel) return;
        sel.addEventListener("change", (e)=>{
          const url = buildLangUrl(String(e.target.value).toLowerCase());
          location.href = url;
        });
      });
    })();
  </script>
</body>
</html>
